<script>
// ---------- ELEMENTY ----------
const terminal = document.getElementById("terminal");
const finalImage = document.getElementById("finalImage");
const pressKey = document.getElementById("pressKey");

// ---------- SEZNAM HLÁŠEK ----------
const lines = [
  "C:\\FIS> run PF2026.exe",
  "Initializing PF2026.exe ...",
  "Connecting to FIS mainframe ...",
  "Compiling data happiness.dll ... ok",
  "Loading joy modules ........... done",
  "Rendering festive vibes ...",
  "PF 2026 — Fakulta informatiky a statistiky"
];

// ---------- KURZOR ----------
const cursor = document.createElement("span");
cursor.id = "cursor";
terminal.appendChild(cursor);

// ---------- ZVUKY ----------
const typeSoundUrl = "https://cdn.pixabay.com/download/audio/2022/03/15/audio_5bfb7b0f24.mp3?filename=typewriter-key-1-117234.mp3";
const successSoundUrl = "https://cdn.pixabay.com/download/audio/2022/03/15/audio_939b5f7393.mp3?filename=notification-1-126517.mp3";

let typeSoundEnabled = false;
const typeSound = new Audio(typeSoundUrl);
typeSound.volume = 0.2;

const successSound = new Audio(successSoundUrl);
successSound.volume = 0.3;

function playClick() {
  if (!typeSoundEnabled) return;
  const click = typeSound.cloneNode();
  click.play().catch(()=>{});
}

// ---------- EFEKT PSANÍ ----------
function typeLine(line, delay = 40) {
  return new Promise(resolve => {
    let i = 0;
    function next() {
      if (i < line.length) {
        cursor.insertAdjacentText("beforebegin", line[i]);
        playClick();
        i++;
        setTimeout(next, delay);
      } else {
        cursor.insertAdjacentText("beforebegin", "\n");
        resolve();
      }
    }
    next();
  });
}

// ---------- HLAVNÍ ANIMACE ----------
async function runTerminal() {
  for (const line of lines) {
    await typeLine(line);
    await new Promise(r => setTimeout(r, 300));
  }
  pressKey.style.display = "block";
}

// ---------- LOADING BAR ----------
async function showLoadingBar() {
  pressKey.style.display = "none";

  const barLine = document.createElement("div");
  terminal.appendChild(barLine);

  let progress = 0;
  const total = 30;

  const interval = setInterval(() => {
    if (progress <= total) {
      const color = progress % 2 === 0 ? "#00b050" : "#66ff99";
      barLine.innerHTML = `<span style="color:${color}">Loading final image: [${"=".repeat(progress)}${" ".repeat(total - progress)}] ${Math.floor((progress / total) * 100)}%</span>`;
      playClick();
      progress++;
    } else {
      clearInterval(interval);
      barLine.innerHTML = `<span style="color:#00ff66">Loading final image: [${"=".repeat(total)}] 100%</span>\n`;
      flashScreen();
      successSound.play().catch(()=>{});
      setTimeout(() => {
        finalImage.style.display = "block";
      }, 600);
    }
  }, 100);
}

// ---------- BLIK OBRAZOVKY ----------
function flashScreen() {
  document.body.style.backgroundColor = "#00b050";
  setTimeout(() => document.body.style.backgroundColor = "#000", 120);
}

// ---------- REAKCE NA UŽIVATELE ----------
function handleUserInput() {
  document.body.removeEventListener("click", handleUserInput);
  document.body.removeEventListener("keydown", handleUserInput);

  // ✅ Aktivace zvuku po první interakci
  typeSoundEnabled = true;
  successSound.play().catch(()=>{}); // krátce přehraje, aby browser „odemknul“ audio
  successSound.pause();
  successSound.currentTime = 0;

  showLoadingBar();
}

document.body.addEventListener("click", handleUserInput);
document.body.addEventListener("keydown", handleUserInput);

// ---------- START ----------
runTerminal();
</script>
